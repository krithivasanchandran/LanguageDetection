package com.locdata.theatres.scraper;

import java.io.IOException;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import org.w3c.dom.NodeList;

import com.XMLParser.LocData.XmlParser;
import com.locdata.geocoding.google.service.GeoCodeEntityCarrierToExcelWriter;
import com.locdata.geocoding.google.service.GeoCodingApi;
import com.locdata.google.api.sheetsWriter.SheetLocalWriter;
import com.locdata.scraper.main.ScraperLogic;
import com.locdata.utils.common.CommonUtils;

public class Theatres_Odeon_Cinemas_LocData {
	
	static List<String> theatreUrls = new ArrayList<String>();
	public static Set<GeoCodeEntityCarrierToExcelWriter> odeonCinemasKeyDataSet = new HashSet<GeoCodeEntityCarrierToExcelWriter>();
	
	public static void main(String args[]) throws IOException, InterruptedException {
		
		String root = "http://www.odeon.co.uk/cinemas/";
		
		org.w3c.dom.Document document = XmlParser.parseXml(parentUrl);
		
		document.getDocumentElement().normalize();
		
		NodeList nodes = document.getElementsByTagName("url");
        
		// iterate the employees
        for (int i = 0; i < nodes.getLength(); i++) {
           Element element = (Element) nodes.item(i);
           
           final GeoCodeEntityCarrierToExcelWriter object = new GeoCodeEntityCarrierToExcelWriter();
           
           NodeList name = element.getElementsByTagName("Attribute");
           for(int k=0;k<name.getLength();k++){
        	   Element line = (Element) name.item(k);
        	   
        	   switch(k){
        	   
        	   case 1:
        		   System.out.println("Theatre name :::: " + line.getTextContent());
        		   object.setStorename(line.getTextContent());
        		   break;
        	   case 2:
        		   System.out.println(" Theatre ID :::: " + line.getTextContent());
        		   object.setStorenumber(Integer.parseInt(line.getTextContent()));
        		   break;
        	   case 3:
        		   System.out.println(" Address Line1 :::: " + line.getTextContent());
        		   object.setAddress(line.getTextContent());
        		   break;
        	   case 4:
        		   System.out.println("city ::::: " + line.getTextContent());
        		   object.setCity(line.getTextContent());
        		   break;
        	   case 5:
        		   System.out.println(" state ::::: " + line.getTextContent());
        		   object.setState(line.getTextContent());
        		   break;
        	   case 6: 
        		   System.out.println(" Postal Code ::: " + line.getTextContent());
        		   object.setZipcode(line.getTextContent());
        		   break;
        	   }
            
           }

		Elements e = doc.select("div#wrapper");
		
		e.forEach((a) -> {
				
			for(Element peter : a.select("select#your-cinema")){
				
				for(Element x : peter.getElementsByTag("option")){
					if(!(x.text().trim().equalsIgnoreCase("Select a cinema") || x.text().trim().equalsIgnoreCase("Select your cinema"))){
						
							String str = x.text().trim();
							
							if(str.contains("Dudley")){
								
								System.out.println(" String match successfull ========> ");
								str = "Dudley";
								System.out.println("replaced value String match successfull ========> " + str);

							}
							
							str = str.replace("(New)","");
							str = str.replace("- ODEON Luxe","");
							str = str.replace(" - The Lounge","");
							str = str.replace(" ","");
							
							System.out.println("Website ---> " + str);
							System.out.println(" Value ----> " + x.attr("value"));
							theatreUrls.add(root.concat(str+"/"+x.attr("value")));
						}
				}
			}
			});
		
		theatreUrls.forEach((action) -> {
			System.out.println(" ===========> " + action);
			
			final GeoCodeEntityCarrierToExcelWriter g = new GeoCodeEntityCarrierToExcelWriter();
			
			String raw = action.split("cinemas/")[1];
			String storename = raw.split("/")[0];
			String storenumber = raw.split("/")[1];
			g.setStorename(storename);
			g.setStorenumber(Integer.parseInt(storenumber));
			
			System.out.println(" Store name ----- > " + storename );
			System.out.println(" Store number ------> " + storenumber);
			
			Document document = ScraperLogic.Scraper.fetchHtmlContents(action);

			CommonUtils.checkDoc(document, Theatres_Odeon_Cinemas_LocData.class);
			
			for(Element element : document.getElementsByTag("div")){
				String el = element.attr("id");
				
				if(el.contains("gethere")){
						System.out.println("Address ---> " + element.select(".description").text());
						g.setAddress(element.select(".description").text());
						try {
							new GeoCodingApi(g.getAddress(), g);
						} catch (Exception e1) {
						   System.out.println(e1.getMessage());
						}
				}
			}
			
			document.select("div#corporate-hire").stream().forEach((i) -> {
				i.select(".row").stream().forEach((p) -> {
					p.select(".unstyled.grey-box").forEach((o) -> {
						System.out.println(" Phone number -----------> " + o.getElementsByTag("strong").text());
						g.setPhoneNumber(o.getElementsByTag("strong").text());
					});
				});
			});
		odeonCinemasKeyDataSet.add(g);	
});
		SheetLocalWriter.writeXLSXFile("OdeonCinemasUKTheatre.xlsx",odeonCinemasKeyDataSet);
}}