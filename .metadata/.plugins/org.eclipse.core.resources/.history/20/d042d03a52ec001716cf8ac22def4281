package com.locdata.theatres.scraper;

import java.io.IOException;
import java.util.HashSet;
import java.util.Set;

import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

import com.locdata.scraper.main.ScraperLogic;

public class Theatres_CineplexEntertainment_LocData {
	
	static Set<String> loc_data = new HashSet<String>();
	
	public static void main(String args[]) throws IOException, InterruptedException {

		Document doc = ScraperLogic.Scraper.fetchHtmlContents("https://en.wikipedia.org/wiki/List_of_Cineplex_Entertainment_movie_theatres");

		if(doc == null){
			System.out.println(" The link is broken ");
		    throw new IllegalArgumentException("Document !!! urls is null ::: Program Exited " + Theatres_CineplexEntertainment_LocData.class.getSimpleName());
		}
		
		Element content = doc.getElementById("mw-content-text");
		
		Elements s = content.getElementsByTag("table");
		
		s.forEach((a) -> {
			
			Elements t = a.getElementsByTag("tbody");
			
			t.parallelStream().forEach((theatrelist) -> {
				Elements k = theatrelist.getElementsByTag("tr");
				
				for(Element q : k){
					if(!q.getElementsByTag("td").text().contains("[edit]")){
						
						if(q.select("td").size() > 0){
							
							loc_data.add(q.select("td").first().text());
						}
					}
				}
			});
		});
		
		loc_data.forEach((action) ->
		{
			Document document = ScraperLogic.Scraper.fetchHtmlContents("https://www.cineplex.com/Theatres/TheatreListings?LocationURL="+action+"&Range=50");

			if(document == null){
				System.out.println(" The link is broken ");
			    throw new IllegalArgumentException("Document !!! urls is null ::: Program Exited " + Theatres_CineplexEntertainment_LocData.class.getSimpleName());
			}		
			
			Elements t = document.body().select("div#Wrapper");
			
			t.forEach((theatrelist) -> {
				
				Elements k = theatrelist.select(".showtime-theatre");
				
				for(Element q : k){
							
								System.out.println("  $$$$ "  + q.getElementsByAttributeValue("itemprop", "telephone").text());
					}
				});
		});
	}
}